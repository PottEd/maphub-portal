maphub.TaggingView=function(e,t){this.callback_url=e,this.timeout=t,this.tags=new Array,this.status="idle";var n=this;window.tagging_view=this,$("#annotation_body").keyup(function(){$(this).doTimeout("annotation-timeout",n.timeout,function(){var e=encodeURIComponent($("#annotation_body").val().replace(/[^\w\s]/gi,""));if(e!==""||e!="Add your annotation here!")if(n.status!="loading"){var t=n.callback_url+"?"+"text="+e+"&"+"annotation[boundary][ne_x]="+$("#annotation_boundary_attributes_ne_x").val()+"&"+"annotation[boundary][ne_y]="+$("#annotation_boundary_attributes_ne_y").val()+"&"+"annotation[boundary][sw_x]="+$("#annotation_boundary_attributes_sw_x").val()+"&"+"annotation[boundary][sw_y]="+$("#annotation_boundary_attributes_sw_y").val();$("#no-tags").hide(),$("#loading-tags").show(),n.status="loading",$.getJSON(t,function(e){$("#loading-tags").hide(),$("#tagging-help").fadeIn("slow"),$.each(e,function(e,t){var r=t.label,i=t.dbpedia_uri,s=t.description;if(n.tags[r]===undefined){var o=$(document.createElement("span"));o.attr("class","label label-neutral"),o.text(r);var u=$(document.createElement("a"));u.attr("rel","tooltip"),u.attr("title",s),u.html(o),u.appendTo($("#modal-annotation-tags"));var a=$(document.createElement("div"));a.attr("class","tag-fields");var f=$(document.createElement("input"));f.attr("type","text"),f.css("display","none"),f.attr("name","label[]"),f.attr("value",r),f.appendTo(a);var l=$(document.createElement("input"));l.attr("type","text"),l.css("display","none"),l.attr("name","dbpedia_uri[]"),l.attr("value",i),l.appendTo(a);var c=$(document.createElement("input"));c.attr("type","text"),c.css("display","none"),c.attr("name","description[]"),c.attr("value",s),c.appendTo(a);var h=$(document.createElement("input"));h.attr("type","text"),h.css("display","none"),h.attr("name","status[]"),h.attr("value","neutral"),h.appendTo(a),a.appendTo($("#modal-annotation-tags")),n.tags[r]=t,o.click(function(){$(this).hasClass("label-neutral")?($(this).removeClass("label-neutral").addClass("label-success"),n.tags[r].status="accepted",h.attr("value","accepted")):$(this).hasClass("label-success")?($(this).removeClass("label-success").addClass("label-important"),n.tags[r].status="rejected",h.attr("value","rejected")):$(this).hasClass("label-important")&&($(this).removeClass("label-important").addClass("label-neutral"),n.tags[r].status="neutral",h.attr("value","neutral"))})}}),n.status="idle"})}})})},maphub.TaggingView.prototype.reset=function(){this.tags=new Array};